language: java
dist: trusty
group: edge
jdk: oraclejdk8
sudo: required # To ensure we get a VM rather than a container for more memory and for all the apt-get stuff

services:
  - docker

env:
  global:
    # $TAGPERM environment variable
    # generate a token at https://github.com/settings/tokens and encrypt it
    # with `travis encrypt TAGPERM=<yoursecrettoken>`
    # also see: https://docs.travis-ci.com/user/encryption-keys/#Usage
    # and: https://docs.travis-ci.com/user/best-practices-security/
    - secure: MjdvQpO3CVFiT6iT+sGpPfefPJ6QZJhXJRKoe6F3tSBJtiu3FLBf9J44+qOHRmOFMTAKBhYlfk1X34lIG7w2wmUEJWvs9mMN7xIMwuobgciUlTyzQcMaeQwp93hBSIWQ1EC8SmmPOyLDkM7F8rCc8e4phDePV3KGDQz6vnYhhX5IH2pharsmtjH/rBSYrjJ2zPRIUNeDl8+pwZryHH+vj8/3djNfZOKrDxj28DAb5Hd8cM4EEBZ5cGfEaEYXRqITQEfenjQtAFQRI2owFJUkVd1wXD1HcZuLJFCzetARDVok2oujhh/7nNs0HsyLF3ffa5v199OU50V2uH/fcO7EskbYt8k+mDYuq4KXo9JA/rQ711LlGrHndtPQTnyLrJzBOQO1zPKo+tsDyEINjL7UuRZI8z6dD+sk/y7Wj69OqXyb9krar957lUx4eCTIzR96FvgQMTX8ZNsTLPS3gRuPp5HxybalTztW2O2jUF148fOzfm4K+9TofMhrRkSmA21mf+l1mqODilJIRIlUX7o7DAOYnDpnbNWPEK1/GGzpPIH1yajdjMqTatcmjeHpX0MsHBufQFlRuvXBpt2I1tp3PeWCkqk8ddDc4GPaMN5ml4MWmEGT7NiD3nYIeiEzLhaHV1LAg7S+7l+UbQbxLJRI7exzKn3n7bIeyJGOXlvPw5w=

install: echo "skip 'gradle assemble' step to speed up build"

before_script: ./travis.before_script.sh

# Use 1 local worker to avoid using too much memory as each worker will chew up ~500Mb ram
script: ./travis.script.sh

# Push to GitHub releases for any tagged commit - the key was generated by the Travis CLI: `$ travis setup releases`
deploy:
  provider: releases
  api_key:
    secure: Xv5WGPYWWM24rkmQ0EgLsRW29THsJjzBcTujv4HXDpgeevkF3CDs+avsrv+24OGc+FD9fA0H+N3rKfsXFK9axxIskyVQ0wEgchPiuODpn7o0FZ+AFCiijh79oRVtFzRanEQXS8CVmx6Td6gtQo+7hUacRPA547b1k2tf4uXDFaxIs8WFIaOzgMINjzgP8L9E6m968a4gt/iuPjaCMp03GJsyqt+/lzRFu2wKtiTKw5KYfny9mg/gNXGBcYtrt9nN9SueEmYQP+NKOQHiGLjTWJ8ItGK+8AzDKjDKPirrkBoT40c6XPgZlzWWOMf1rvDNz+10ATEB2cxeQw08CmiKAnP3/f/KgpEmsVIXs5hrvy2Pvgyz6Ndzg0qn5XmhuUtclbdIBTW3CdIWujVbStBTErAvjoUyKhgpthyt8qMkWT5BShXBwnzOoQ+ujscs55Plkzv+fOQKcZgdQikE/8ZEIu2+7p4PAXWZKkVE1kQUyVD3yNlgN3ux5zPnHknHnfyOIRXDZayiWgNefiCB/9KW8OZ6qOnT2Ji+AMBFvL30udcFwD0T8veEIXphYr4CijgZbEVZwWDkOwDnK9EzPO5P9RXzvQP5ilVqLEvxTMggA4NVN2LPl31Qy+lhC4Ya/wtfqAP/jbzxkTI2U12Xo0+VbiYWShsXIHf3KzOMFGjpvl4=
  file: stroom-query-elastic-svc/build/libs/stroom-query-elastic-all.jar
  skip_cleanup: true
  on:
    repo: gchq/stroom-query-elastic
    tags: true

# Clean out gradle caches as per travis docs
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

# Cache dependencies to speed up the build
cache:
  directories:
    - .autoconf
    - $HOME/.m2
    - libs
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

